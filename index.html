<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>九易点单系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .card {
      background: #ffffff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
    }

    .product {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .controls button {
      width: 30px;
      height: 30px;
      font-size: 18px;
    }

    .controls span {
      margin: 0 10px;
      font-weight: bold;
    }

    .admin-order {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }

    .muted {
      color: #777;
      font-size: 14px;
    }
  </style>
</head>

<body>

<!-- ========== 客户端界面 ========== -->
<div id="client-view">
  <h1>九易点单系统</h1>

  <div class="card">
    <div id="room-info"></div>
    <div class="muted">扫码后自动识别包厢</div>
  </div>

  <div class="card">
    <h3>商品列表</h3>
    <div id="menu"></div>
  </div>
</div>

<!-- ========== 老板端界面 ========== -->
<div id="admin-view" style="display:none;">
  <h1>老板管理端</h1>
  <div class="card" id="admin-orders"></div>
</div>

<script>
/* ========= 基础参数 ========= */
const params = new URLSearchParams(window.location.search);
const role = params.get("role");
const room = params.get("room");

/* ========= 页面切换 ========= */
const clientView = document.getElementById("client-view");
const adminView = document.getElementById("admin-view");

if (role === "admin") {
  clientView.style.display = "none";
  adminView.style.display = "block";
  renderAdmin();
} else {
  adminView.style.display = "none";
  clientView.style.display = "block";
  initClient();
}

/* ========= 商品配置 ========= */
const products = [
  { id: "cola", name: "可乐", price: 5 },
  { id: "sprite", name: "雪碧", price: 5 },
  { id: "water", name: "矿泉水", price: 3 },
  { id: "chips", name: "薯片", price: 6 }
];

/* ========= 客户端逻辑 ========= */
function initClient() {
  const roomInfo = document.getElementById("room-info");
  roomInfo.innerHTML = `<strong>当前包厢：</strong>${room || "未知"}`;

  const menu = document.getElementById("menu");
  const orders = loadOrders();

  products.forEach(p => {
    const count = orders[room]?.[p.id] || 0;

    const div = document.createElement("div");
    div.className = "product";
    div.innerHTML = `
      <span>${p.name} ￥${p.price}</span>
      <div class="controls">
        <button onclick="changeItem('${p.id}', -1)">−</button>
        <span id="count-${p.id}">${count}</span>
        <button onclick="changeItem('${p.id}', 1)">＋</button>
      </div>
    `;
    menu.appendChild(div);
  });
}

function changeItem(productId, delta) {
  if (!room) return;

  const orders = loadOrders();
  if (!orders[room]) orders[room] = {};
  if (!orders[room][productId]) orders[room][productId] = 0;

  orders[room][productId] += delta;
  if (orders[room][productId] < 0) orders[room][productId] = 0;

  saveOrders(orders);
  document.getElementById(`count-${productId}`).innerText = orders[room][productId];
}

/* ========= 老板端逻辑 ========= */
function renderAdmin() {
  const container = document.getElementById("admin-orders");
  const orders = loadOrders();

  if (Object.keys(orders).length === 0) {
    container.innerHTML = "暂无订单";
    return;
  }

  container.innerHTML = "";

  for (const room in orders) {
    const div = document.createElement("div");
    div.className = "admin-order";

    let html = `<strong>包厢 ${room}</strong><br/>`;
    let total = 0;

    for (const pid in orders[room]) {
      const product = products.find(p => p.id === pid);
      const count = orders[room][pid];
      if (count > 0) {
        html += `${product.name} × ${count}<br/>`;
        total += product.price * count;
      }
    }

    html += `<strong>小计：￥${total}</strong>`;
    div.innerHTML = html;
    container.appendChild(div);
  }
}

/* ========= 本地存储 ========= */
function loadOrders() {
  return JSON.parse(localStorage.getItem("mahjong_orders") || "{}");
}

function saveOrders(data) {
  localStorage.setItem("mahjong_orders", JSON.stringify(data));
}
</script>

</body>
</html>