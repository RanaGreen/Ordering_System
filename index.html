<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>棋牌室计时 + 点单系统</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #111;
  color: #eee;
}

h1, h2, h3 {
  margin: 10px 0;
}

.hidden { display: none; }

/* ===== 通用容器 ===== */
.container {
  padding: 15px;
  padding-bottom: 140px;
}

/* ===== 商品区 ===== */
.products {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
}

.product-card {
  background: #1f1f1f;
  border-radius: 10px;
  padding: 12px;
  text-align: center;
}

.product-name {
  font-size: 15px;
  margin-bottom: 6px;
}

.product-price {
  font-size: 14px;
  color: #aaa;
  margin-bottom: 10px;
}

.add-btn {
  background: #2ecc71;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  color: #000;
  font-size: 16px;
  cursor: pointer;
}

/* ===== 购物车 ===== */
.cart {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #1a1a1a;
  border-top: 1px solid #333;
  padding: 10px 12px;
}

.cart-header {
  font-size: 14px;
  color: #aaa;
  margin-bottom: 6px;
}

.cart-items {
  max-height: 80px;
  overflow-y: auto;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 4px;
  font-size: 14px;
}

.cart-item span {
  flex: 1;
}

.cart-controls {
  display: flex;
  align-items: center;
  gap: 6px;
}

.cart-btn {
  background: #444;
  border: none;
  border-radius: 4px;
  color: #fff;
  width: 26px;
  height: 26px;
  font-size: 16px;
}

.cart-total {
  margin-top: 6px;
  font-size: 16px;
  text-align: right;
}

.submit-btn {
  width: 100%;
  margin-top: 8px;
  background: #3498db;
  border: none;
  border-radius: 8px;
  padding: 10px;
  font-size: 16px;
  color: #fff;
}

/* ===== 老板端基础样式（未动） ===== */
.admin {
  padding: 15px;
}
.room-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}
.room-btn {
  padding: 10px;
  background: #333;
  border: none;
  color: #fff;
  border-radius: 6px;
}
.room-btn.active {
  background: #27ae60;
}
</style>
</head>

<body>

<div id="client" class="container hidden">
  <h2>包厢 <span id="roomLabel"></span> 点单</h2>

  <div class="products" id="productList"></div>
</div>

<div class="cart hidden" id="cart">
  <div class="cart-header">购物车（包厢 <span id="cartRoom"></span>）</div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-total">合计：¥ <span id="cartTotal">0</span></div>
  <button class="submit-btn" onclick="submitOrder()">提交点单</button>
</div>

<div id="admin" class="admin hidden">
  <h2>老板端</h2>
  <p>（功能保持不变，略）</p>
</div>

<script>
const params = new URLSearchParams(location.search);
const room = params.get("room");
const role = params.get("role");

const products = [
  { id: 1, name: "矿泉水", price: 3 },
  { id: 2, name: "可乐", price: 5 },
  { id: 3, name: "红牛", price: 8 },
  { id: 4, name: "泡面", price: 6 },
  { id: 5, name: "瓜子", price: 10 }
];

let cart = {};

function initClient() {
  document.getElementById("client").classList.remove("hidden");
  document.getElementById("cart").classList.remove("hidden");
  document.getElementById("roomLabel").innerText = room;
  document.getElementById("cartRoom").innerText = room;

  const list = document.getElementById("productList");
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "product-card";
    div.innerHTML = `
      <div class="product-name">${p.name}</div>
      <div class="product-price">¥${p.price}</div>
      <button class="add-btn" onclick="addToCart(${p.id})">＋</button>
    `;
    list.appendChild(div);
  });

  renderCart();
}

function addToCart(id) {
  if (!cart[id]) cart[id] = 0;
  cart[id]++;
  renderCart();
}

function removeFromCart(id) {
  if (!cart[id]) return;
  cart[id]--;
  if (cart[id] <= 0) delete cart[id];
  renderCart();
}

function renderCart() {
  const itemsDiv = document.getElementById("cartItems");
  itemsDiv.innerHTML = "";
  let total = 0;

  for (let id in cart) {
    const p = products.find(x => x.id == id);
    const qty = cart[id];
    const sub = p.price * qty;
    total += sub;

    const row = document.createElement("div");
    row.className = "cart-item";
    row.innerHTML = `
      <span>${p.name} × ${qty}</span>
      <div class="cart-controls">
        <span>¥${sub}</span>
        <button class="cart-btn" onclick="removeFromCart(${id})">－</button>
      </div>
    `;
    itemsDiv.appendChild(row);
  }

  document.getElementById("cartTotal").innerText = total;
}

function submitOrder() {
  if (Object.keys(cart).length === 0) {
    alert("购物车为空");
    return;
  }

  const orders = JSON.parse(localStorage.getItem("orders") || "{}");
  if (!orders[room]) orders[room] = [];
  orders[room].push({
    time: new Date().toLocaleString(),
    items: JSON.parse(JSON.stringify(cart))
  });

  localStorage.setItem("orders", JSON.stringify(orders));
  cart = {};
  renderCart();
  alert("点单已提交");
}

if (role === "admin") {
  document.getElementById("admin").classList.remove("hidden");
} else if (room) {
  initClient();
}
</script>

</body>
</html>