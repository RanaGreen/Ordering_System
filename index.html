<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>棋牌室计时＋点单系统</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: #111;
  color: #eee;
}

h1, h2 {
  margin: 12px 0;
}

.container {
  padding: 16px;
}

.hidden {
  display: none;
}

/* ===== 通用卡片 ===== */
.card {
  background: #1e1e1e;
  border-radius: 10px;
  padding: 14px;
  margin-bottom: 14px;
}

/* ===== 商品区 ===== */
.goods-list {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.goods-item {
  background: #2a2a2a;
  padding: 10px;
  border-radius: 8px;
}

.goods-name {
  font-size: 15px;
}

.goods-price {
  font-size: 13px;
  opacity: 0.8;
}

.goods-actions {
  margin-top: 8px;
}

.goods-actions button {
  width: 32px;
  height: 32px;
  font-size: 18px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 6px;
}

/* ===== 已点清单 ===== */
.cart-item {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
}

.cart-actions button {
  width: 26px;
  height: 26px;
  margin-left: 4px;
  background: #555;
  color: #fff;
  border: none;
  border-radius: 5px;
}

.total {
  font-size: 18px;
  margin-top: 10px;
}

.submit-btn {
  margin-top: 12px;
  width: 100%;
  padding: 12px;
  background: #3a8bfd;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
}

/* ===== 老板端 ===== */
.room-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.room-btn {
  padding: 14px;
  background: #333;
  border-radius: 8px;
  text-align: center;
}

.room-btn.active {
  background: #3a8bfd;
}
</style>
</head>

<body>
<div class="container">

  <!-- ========== 客户端 ========== -->
  <div id="clientView" class="hidden">
    <h1>包厢 <span id="roomNo"></span> 点单</h1>

    <div class="card">
      <h2>商品</h2>
      <div class="goods-list" id="goodsList"></div>
    </div>

    <div class="card">
      <h2>已点商品</h2>
      <div id="cartList"></div>
      <div class="total">合计：¥ <span id="totalPrice">0</span></div>
      <button class="submit-btn" onclick="submitOrder()">提交点单</button>
    </div>
  </div>

  <!-- ========== 老板端 ========== -->
  <div id="adminView" class="hidden">
    <h1>老板端</h1>

    <div class="card">
      <h2>包厢一览</h2>
      <div class="room-grid" id="roomGrid"></div>
    </div>

    <div class="card">
      <h2>订单记录</h2>
      <pre id="adminLog"></pre>
    </div>
  </div>

</div>

<script>
/* ================= 基础数据 ================= */

const goods = [
  { id: 1, name: "可乐", price: 5 },
  { id: 2, name: "雪碧", price: 5 },
  { id: 3, name: "啤酒", price: 8 },
  { id: 4, name: "瓜子", price: 10 },
  { id: 5, name: "泡面", price: 12 },
  { id: 6, name: "香烟", price: 25 }
];

let cart = {};
let roomId = null;

/* ================= 路由判断 ================= */

const params = new URLSearchParams(location.search);

if (params.get("role") === "admin") {
  showAdmin();
} else if (params.get("room")) {
  roomId = params.get("room");
  showClient(roomId);
}

/* ================= 客户端 ================= */

function showClient(room) {
  document.getElementById("clientView").classList.remove("hidden");
  document.getElementById("roomNo").innerText = room;

  const goodsList = document.getElementById("goodsList");
  goods.forEach(g => {
    const div = document.createElement("div");
    div.className = "goods-item";
    div.innerHTML = `
      <div class="goods-name">${g.name}</div>
      <div class="goods-price">¥${g.price}</div>
      <div class="goods-actions">
        <button onclick="addItem(${g.id})">＋</button>
      </div>
    `;
    goodsList.appendChild(div);
  });
}

function addItem(id) {
  if (!cart[id]) cart[id] = 0;
  cart[id]++;
  renderCart();
}

function removeItem(id) {
  if (!cart[id]) return;
  cart[id]--;
  if (cart[id] <= 0) delete cart[id];
  renderCart();
}

function renderCart() {
  const list = document.getElementById("cartList");
  list.innerHTML = "";
  let total = 0;

  for (const id in cart) {
    const g = goods.find(x => x.id == id);
    const qty = cart[id];
    const subtotal = g.price * qty;
    total += subtotal;

    const row = document.createElement("div");
    row.className = "cart-item";
    row.innerHTML = `
      <div>${g.name} × ${qty} = ¥${subtotal}</div>
      <div class="cart-actions">
        <button onclick="removeItem(${id})">－</button>
        <button onclick="addItem(${id})">＋</button>
      </div>
    `;
    list.appendChild(row);
  }

  document.getElementById("totalPrice").innerText = total;
}

function submitOrder() {
  if (Object.keys(cart).length === 0) return;

  const order = {
    room: roomId,
    time: new Date().toLocaleString(),
    items: cart
  };

  const allOrders = JSON.parse(localStorage.getItem("orders") || "[]");
  allOrders.push(order);
  localStorage.setItem("orders", JSON.stringify(allOrders));

  cart = {};
  renderCart();
  alert("点单已提交");
}

/* ================= 老板端 ================= */

function showAdmin() {
  document.getElementById("adminView").classList.remove("hidden");

  const grid = document.getElementById("roomGrid");
  for (let i = 1; i <= 16; i++) {
    const btn = document.createElement("div");
    btn.className = "room-btn";
    btn.innerText = "包厢 " + i;
    grid.appendChild(btn);
  }

  renderAdminLog();
}

function renderAdminLog() {
  const orders = JSON.parse(localStorage.getItem("orders") || "[]");
  document.getElementById("adminLog").innerText =
    JSON.stringify(orders, null, 2);
}
</script>
</body>
</html>