<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>九易点单系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background: #f5f5f5;
      margin: 0;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      background: #ffffff;
      min-height: 100vh;
      padding: 16px;
      box-sizing: border-box;
    }

    .title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .admin-title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #409eff;
    }

    .room {
      background: #e6f2ff;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }

    .admin-room {
      background: #e6f7ed;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 16px;
      color: #67c23a;
    }

    .section-title {
      font-size: 18px;
      margin: 16px 0 8px;
      font-weight: bold;
    }

    .admin-section-title {
      font-size: 18px;
      margin: 16px 0 8px;
      font-weight: bold;
      color: #409eff;
      border-left: 4px solid #409eff;
      padding-left: 8px;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .item button {
      background: #409eff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
    }

    .order {
      background: #fafafa;
      padding: 10px;
      border-radius: 6px;
      margin-top: 16px;
    }

    .admin-summary {
      background: #f0f9ff;
      padding: 10px;
      border-radius: 6px;
      margin-top: 16px;
      border: 1px solid #d9ecff;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .admin-order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
      padding: 8px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .controls button {
      margin-left: 6px;
      padding: 2px 8px;
      font-size: 14px;
    }

    .total {
      font-weight: bold;
      margin-top: 10px;
      text-align: right;
    }

    .admin-total {
      font-weight: bold;
      margin-top: 10px;
      text-align: right;
      color: #409eff;
      font-size: 16px;
    }

    .placeholder {
      text-align: center;
      padding: 40px 20px;
      color: #999;
      font-size: 16px;
      background: #f9f9f9;
      border-radius: 8px;
      margin-top: 20px;
    }

    .room-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .room-tag {
      background: #e6f2ff;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .room-tag:hover {
      background: #d9ecff;
      transform: translateY(-2px);
    }

    .room-tag.active {
      background: #409eff;
      color: white;
      box-shadow: 0 2px 5px rgba(64, 158, 255, 0.3);
    }

    .admin-controls {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .admin-controls button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .admin-controls button:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
      background: #409eff;
      color: white;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .empty-room {
      text-align: center;
      padding: 20px;
      color: #999;
      font-size: 14px;
      background: #f9f9f9;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>

<body>
<div class="container" id="container">
  <!-- 内容将由JavaScript动态生成 -->
</div>

<script>
  // 读取URL参数
  const params = new URLSearchParams(window.location.search);
  const room = params.get("room");
  const role = params.get("role");
  
  const container = document.getElementById("container");
  
  // 定义所有16个包厢
  const allRooms = [
    "V111", "V222", "V333", "V04", "V555", "V666", "V777", "V888",
    "V999", "V10", "U1", "U2", "U3", "U5", "U6", "U7"
  ];
  
  // 判断是否为老板端
  const isAdmin = role === "admin";
  
  if (isAdmin) {
    // 初始化老板端
    initAdmin();
  } else {
    // 初始化客户端
    initClient();
  }
  
  function initClient() {
    // 客户端点单系统 - 原有逻辑
    container.innerHTML = `
      <div class="title">九易点单系统</div>
      <div class="room" id="roomInfo"></div>
      <div class="section-title">商品列表</div>
      <div id="items"></div>
      <div class="section-title">当前订单</div>
      <div class="order" id="orderList">暂无商品</div>
      <div class="total" id="totalPrice">合计：0 元</div>
    `;
    
    // 检查包厢是否有效
    const isValidRoom = allRooms.includes(room);
    document.getElementById("roomInfo").innerText =
      isValidRoom ? `当前包厢：${room}` : "未识别包厢 (请使用有效包厢号)";

    // 商品配置
    const products = [
      { id: 1, name: "可乐", price: 5 },
      { id: 2, name: "雪碧", price: 5 },
      { id: 3, name: "矿泉水", price: 3 },
      { id: 4, name: "泡面", price: 8 },
      { id: 5, name: "薯片", price: 6 },
      { id: 6, name: "啤酒", price: 10 }
    ];

    // 当前订单
    const order = {};

    const itemsDiv = document.getElementById("items");
    const orderListDiv = document.getElementById("orderList");
    const totalPriceDiv = document.getElementById("totalPrice");

    // 商品列表
    products.forEach(p => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <span>${p.name}（${p.price} 元）</span>
        <button>加入</button>
      `;
      div.querySelector("button").onclick = () => add(p);
      itemsDiv.appendChild(div);
    });

    function add(product) {
      if (!order[product.id]) {
        order[product.id] = { ...product, count: 1 };
      } else {
        order[product.id].count++;
      }
      render();
    }

    function sub(productId) {
      if (!order[productId]) return;
      order[productId].count--;
      if (order[productId].count <= 0) {
        delete order[productId];
      }
      render();
    }

    function render() {
      orderListDiv.innerHTML = "";
      let total = 0;
      let empty = true;

      for (const id in order) {
        empty = false;
        const item = order[id];
        const lineTotal = item.price * item.count;
        total += lineTotal;

        const div = document.createElement("div");
        div.className = "order-item";
        div.innerHTML = `
          <span>${item.name} × ${item.count}</span>
          <span class="controls">
            <button onclick="sub(${id})">−</button>
          </span>
        `;
        orderListDiv.appendChild(div);
      }

      if (empty) {
        orderListDiv.innerText = "暂无商品";
      }

      totalPriceDiv.innerText = `合计：${total} 元`;
    }
    
    // 将sub函数暴露给全局，供按钮点击调用
    window.sub = sub;
  }
  
  function initAdmin() {
    // 老板端管理系统
    container.innerHTML = `
      <div class="admin-title">九易点单系统 - 老板端</div>
      <div class="admin-room" id="roomInfo">
        <div>老板端管理面板</div>
        <div style="font-size:14px; color:#666; margin-top:5px;">共 ${allRooms.length} 个包厢</div>
      </div>
      
      <div class="admin-section-title">包厢列表</div>
      <div class="room-list" id="roomList">
        <!-- 包厢标签将动态生成 -->
      </div>
      
      <div class="admin-section-title">今日订单汇总</div>
      <div class="admin-summary" id="orderSummary">
        <div class="empty-room" id="emptySummary">请点击上方包厢查看详情</div>
      </div>
      
      <div class="admin-total" id="adminTotal">选择包厢查看订单详情</div>
      
      <div class="admin-section-title">管理功能</div>
      <div class="placeholder" id="placeholder">
        老板端功能开发中...<br>
        后续版本将添加：<br>
        • 实时查看各包厢订单<br>
        • 商品库存管理<br>
        • 销售数据统计<br>
        • 员工管理
      </div>
      
      <div class="admin-controls">
        <button class="btn-secondary" onclick="window.location.href='?'">返回客户点单</button>
        <button class="btn-primary" onclick="refreshData()">刷新所有数据</button>
      </div>
    `;
    
    // 动态生成包厢列表
    const roomListDiv = document.getElementById("roomList");
    
    // 添加"所有包厢"标签
    const allRoomsTag = document.createElement("div");
    allRoomsTag.className = "room-tag active";
    allRoomsTag.textContent = "所有包厢";
    allRoomsTag.addEventListener('click', () => showAllRoomsSummary());
    roomListDiv.appendChild(allRoomsTag);
    
    // 添加16个包厢标签
    allRooms.forEach(roomName => {
      const roomTag = document.createElement("div");
      roomTag.className = "room-tag";
      roomTag.textContent = roomName;
      roomTag.addEventListener('click', () => showRoomSummary(roomName));
      roomListDiv.appendChild(roomTag);
    });
    
    // 初始化显示所有包厢汇总
    showAllRoomsSummary();
    
    // 为所有包厢标签添加点击事件（使用事件委托）
    roomListDiv.addEventListener('click', function(e) {
      if (e.target.classList.contains('room-tag')) {
        // 移除所有标签的active类
        const allTags = roomListDiv.querySelectorAll('.room-tag');
        allTags.forEach(tag => tag.classList.remove('active'));
        // 为当前点击的标签添加active类
        e.target.classList.add('active');
      }
    });
  }
  
  // 显示所有包厢汇总
  function showAllRoomsSummary() {
    // 模拟所有包厢的总订单数据
    const orderSummaryDiv = document.getElementById("orderSummary");
    const adminTotalDiv = document.getElementById("adminTotal");
    
    // 生成模拟数据
    const products = [
      { name: "可乐", base: 15 },
      { name: "雪碧", base: 12 },
      { name: "矿泉水", base: 8 },
      { name: "泡面", base: 5 },
      { name: "薯片", base: 10 },
      { name: "啤酒", base: 7 }
    ];
    
    let totalRevenue = 0;
    const priceMap = { "可乐": 5, "雪碧": 5, "矿泉水": 3, "泡面": 8, "薯片": 6, "啤酒": 10 };
    
    let summaryHTML = '';
    products.forEach(product => {
      // 随机生成一些变化
      const randomFactor = Math.floor(Math.random() * 5) + 1;
      const quantity = product.base * randomFactor;
      const revenue = quantity * priceMap[product.name];
      totalRevenue += revenue;
      
      summaryHTML += `
        <div class="admin-order-item">
          <span>${product.name}</span>
          <span>${quantity} 件 × ${priceMap[product.name]}元 = ${revenue}元</span>
        </div>
      `;
    });
    
    orderSummaryDiv.innerHTML = summaryHTML;
    adminTotalDiv.textContent = `今日总收入：${totalRevenue} 元 (所有包厢)`;
  }
  
  // 显示单个包厢汇总
  function showRoomSummary(roomName) {
    const orderSummaryDiv = document.getElementById("orderSummary");
    const adminTotalDiv = document.getElementById("adminTotal");
    
    // 根据包厢名称生成不同的模拟数据
    // 使用房间号作为随机种子，确保相同房间每次点击显示相同数据
    let seed = 0;
    for (let i = 0; i < roomName.length; i++) {
      seed += roomName.charCodeAt(i);
    }
    
    // 简单的伪随机生成器
    const random = (max) => (seed * 9301 + 49297) % 233280 % max;
    
    const products = [
      { name: "可乐", base: 2 },
      { name: "雪碧", base: 1 },
      { name: "矿泉水", base: 1 },
      { name: "泡面", base: 1 },
      { name: "薯片", base: 1 },
      { name: "啤酒", base: 1 }
    ];
    
    const priceMap = { "可乐": 5, "雪碧": 5, "矿泉水": 3, "泡面": 8, "薯片": 6, "啤酒": 10 };
    
    let summaryHTML = '';
    let totalRevenue = 0;
    
    products.forEach(product => {
      // 使用种子生成确定但随机的数量
      const quantity = Math.max(0, Math.floor(random(10))) + product.base;
      if (quantity > 0) {
        const revenue = quantity * priceMap[product.name];
        totalRevenue += revenue;
        
        summaryHTML += `
          <div class="admin-order-item">
            <span>${product.name}</span>
            <span>${quantity} 件 × ${priceMap[product.name]}元 = ${revenue}元</span>
          </div>
        `;
      }
    });
    
    if (summaryHTML === '') {
      orderSummaryDiv.innerHTML = `<div class="empty-room">${roomName} 包厢今日暂无订单</div>`;
      adminTotalDiv.textContent = `${roomName} 包厢：0 元`;
    } else {
      orderSummaryDiv.innerHTML = summaryHTML;
      adminTotalDiv.textContent = `${roomName} 包厢：${totalRevenue} 元`;
    }
  }
  
  // 老板端刷新数据函数
  function refreshData() {
    if (!isAdmin) return;
    
    const placeholder = document.getElementById('placeholder');
    const originalText = placeholder.innerHTML;
    placeholder.innerHTML = '正在刷新数据...';
    placeholder.style.color = '#409eff';
    
    // 模拟网络请求延迟
    setTimeout(() => {
      placeholder.innerHTML = originalText;
      placeholder.style.color = '#999';
      
      // 重新计算当前显示的数据
      const activeTag = document.querySelector('.room-tag.active');
      if (activeTag) {
        if (activeTag.textContent === '所有包厢') {
          showAllRoomsSummary();
        } else {
          showRoomSummary(activeTag.textContent);
        }
      }
      
      alert('数据已刷新！');
    }, 800);
  }
</script>
</body>
</html>